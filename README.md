# Slack profile photo weather updater

This project updates your slack profile photo with a photo based on the weather.


## Configuration
You need to provide:
* Two profile photos with a transparent background, for daytime and nighttime. By default, place them in `profile_photos/photo.png` and `profile_photos/night_photo.png`.
* Environment variables:
  - Copy the `.env.template` file to `.env`.
  - Edit the variables:
    - `WEATHERSTACK_API_ACCESS_KEY`: the api key for your account on weatherstack.com.
    - `SLACK_WORKSPACE`: the slack workspace where you want to change your profile photo
    - `SLACK_TOKEN`, `SLACK_COOKIE_D`: see below.
    - `LATITUDE`, `LONGITUDE`: the location for the weather conditions that will be used to fill in the background in your profile photo.

### Retrieving the slack token and cookie values
* Log into slack in a browser on a computer.
* Enable developer tools in the browser, and open the network tab.
* Manually change your profile photo to any photo you want.
* Inspect the request in the developer tools network tab on the `/api/users.setPhoto` endpoint.
  - Copy the value of the `token` parameter into `SLACK_TOKEN` in your `.env` file.
  - For the `SLACK_COOKIE_D` env var, look at the `cookie` header, and extract the value of the `d=` part of the cookie.

### Optional parameters
* `PROFILE_PHOTOS_DIR`: the directory containing your profile photos with the transparent background. It should contain a `photo.png` for daytime, and a `night_photo.png` for nighttime. The default location is in `profile_photos/` in the project.
* `POLLING_INTERVAL_S`: The frequency in seconds to update the profile photo. The default value is `7200`.

## Running the program
* Follow the setup described just above

### Locally
* Setup a python environment
* Run `python wspp.main.py`

### With Docker

Retrieve the docker image:
```
docker pull ghcr.io/caarmen/weather-slack-profile-photo:latest
```

Run the docker image. Indicate the host paths to your `.env` file and `profile_photos` folder.
```
docker run --detach -v `pwd`/.env:/app/.env -v `pwd`/profile_photos/:/app/profile_photos/ ghcr.io/caarmen/weather-slack-profile-photo
```



## Image credits
* The night background photo is from [Alexey Elfimov](https://commons.wikimedia.org/wiki/File:%D0%A1%D0%B2%D0%B5%D1%82_%D0%BE%D1%82_%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BD%D0%B8_-_panoramio.jpg), licensed under the Creative Commons Attribution 3.0 Unported license
* The weather background images were generated by Bing
* The sample profile photos were generated from the Bitmoji app.